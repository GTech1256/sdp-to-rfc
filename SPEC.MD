# Спецификация SaaS-сервиса «SDP → RFC»

## 1. Назначение

Сервис автоматизирует подготовку описаний RFC‑задач на основе существующих задач в SDP. Он собирает информацию из GitHub‑репозиториев, Jira (SDP) и Jenkins, помогает управлять версиями по SemVer и формирует итоговый шаблон RFC, готовый для публикации.

## 2. Основные сущности

| Сущность | Назначение | Ключевые поля |
| --- | --- | --- |
| **SDP Task** | Исходная задача в SDP‑трекере. | `id`, `title`, `description`, `status`, `assignee`, `linksToPR[]` |
| **Pull Request** | PR в GitHub, связанный с SDP Task. | `url`, `repository`, `branch`, `author`, `createdAt` |
| **Project** | Git‑репозиторий, упоминаемый в RFC. | `name`, `currentVersion`, `nextVersion`, `changeType` (patch/minor/major) |
| **Draft RFC** | Черновик описания RFC, заполняемый пользователем. | `id`, `sdpLinks[]`, `prLinks[]`, `projects[]`, `regressionLink`, `status=draft` |
| **RFC** | Финальное описание, готовое к публикации. | `id`, `sdpLinks[]`, `title`, `body`, `createdAt`, `status=ready` |

## 3. Роли пользователей

- **Автор** — создаёт Draft RFC, добавляет PR и выпускает финальный RFC.
- **Наблюдатель** — просматривает черновики и готовые RFC (read‑only).

## 4. Пользовательские сценарии

### 4.1 Создание Draft RFC

1. Пользователь нажимает **«Создать RFC»** на дашборде.
2. В модальном окне вводит **Название RFC** (обязательное поле, 5–100 символов).
3. Нажимает «Сохранить» — создаётся черновик RFC со статусом `Draft` и пустым списком SDP.

### 4.2 Заполнение RFC

1. Пользователь открывает страницу «Редактирование RFC».
2. В секции **SDP‑задачи** добавляет одну или несколько ссылок на SDP; после каждой вставки сервис подтягивает `title` и `description`.
3. Внутри каждой SDP‑строки пользователь переходит во вкладку **Pull Requests** и добавляет одну или несколько ссылок на PR.
4. Сервис собирает уникальный список репозиториев из всех PR во всех SDP и заполняет таблицу **Проекты**.

### 4.3 Генерация финального RFC

1. Пользователь (по желанию) указывает ссылку на регресс‑тест.
2. Нажимает **«Сформировать RFC»**.
3. Сервис для каждого репозитория определяет `currentVersion`, рассчитывает `nextVersion` по SemVer и формирует:
    - блок **План внедрения** (новые теги);
    - блок **План отката** (текущие теги);
    - секцию **Ссылки на SDP**.
4. RFC переходит в статус `Ready`, поля становятся readonly, появляется markdown‑превью и кнопка **«Копировать»**.

### 4.4 Изменения после генерации

Если в готовый RFC добавлены новые SDP или PR, статус автоматически меняется на `Draft`, и пользователь должен повторно нажать «Сформировать RFC».

## 5. Правила версионирования

| Тип изменения | Что изменяется | Пример `current` → `next` |
| --- | --- | --- |
| **patch** | BUG‑fixes | 2.1.2 → **2.1.3** |
| **minor** | Backward‑compatible features | 2.1.2 → **2.2.0** |
| **major** | Breaking changes | 2.1.2 → **3.0.0** |

## 6. Структура итогового RFC

```
Название: <если одна SDP — её заголовок; иначе введите общее название>

Описание: <description из SDP>
<ссылки на SDP>

План внедрения:
• <project‑name> Собрать тег <nextVersion>
...

План отката:
• <project‑name> Откатить на тег <currentVersion>
...

Продукты:
• 0179
• 0796

Регрессионное тестирование:
<regressionLink>
```

## 7. UI/UX

### 7.1 Главная страница (Dashboard)

| Элемент | Описание | Поведение |
| --- | --- | --- |
| **Таблица RFC** | Список всех RFC‑черновиков и готовых RFC. | Колонки: `RFC Title`, `SDPs` (count), `PRs` (count), `Status` (`Draft` / `Ready`), `Updated`. Клик по строке → редактирование. |
| **Кнопка «Создать RFC»** | Плавающая FAB в правом нижнем углу. | Открывает модальное окно создания. |
| **Статус‑баджи** | Серый — Draft, зелёный — Ready. | Tooltip с датой последней генерации. |
| **Empty state** | Иллюстрация и текст «Нет RFC. Создайте первый». | Содержит ту же кнопку создания. |

### 7.2 Модальное окно «Создать RFC»

| Поле | Правила | UX‑детали |
| --- | --- | --- |
| **Название RFC** | Обязательное текстовое поле (5–100 символов). | Автофокус; inline‑валидация; `Сохранить` disabled, пока поле невалидно. |
| **Кнопки** | `Сохранить` (primary) / `Отмена`. | ESC закрывает. |

### 7.3 Страница «Редактирование RFC»

| Блок UI | Содержимое | Поведение |
| --- | --- | --- |
| **Хедер** | Breadcrumb `Главная / RFC`, Badge `Draft` / `Ready`, кнопки `Удалить`, `Назад`. | Автосохранение каждые 5 сек. |
| **Секция «SDP‑задачи»** | Таблица ссылок на SDP: `SDP‑ID`, `Title`, `PRs` (count). | Кнопка «+» добавляет строку; в каждой строке кнопка «PR» разворачивает вложенную таблицу. |
| **Вложенная таблица «Pull Requests»** | Для выбранной SDP: `Repository`, `PR #`, `State`, `Author`. | Внутренняя кнопка «+» добавляет PR. URL‑валидация, не дубликат. |
| **Таблица «Проекты»** | Уникальный список репозиториев из всех PR. Колонки: `Repository`, `Current version`, `Change type` (radio patch/minor/major), `Next version` (input). | При смене `Change type` автопересчёт `Next version`. Ошибка, если `< currentVersion`. |
| **Поле «Ссылка на регресс»** | Однострочный input URL (опционально). | Плейсхолдер «https://allure…». |
| **Кнопка «Сформировать RFC»** | Primary, sticky внизу. | Disabled, если нет ни одной SDP или PR. При нажатии генерирует RFC и переводит статус в `Ready`. |
| **Markdown‑превью RFC** | Появляется после генерации. | Кнопка «Копировать» копирует весь текст. |

### 7.3.1 Состояния формы

- **Draft** — все поля активны.
- **Ready** — read‑only; появляется кнопка «Обновить RFC», если внесены изменения.

### 7.4 Диаграмма навигации

```
graph TD;
  Dashboard -->|Клик row| Edit[Редактирование RFC];
  Dashboard -->|Создать| Modal;
  Modal -->|Сохранить| Edit;
  Edit -->|Back| Dashboard;
```

## 8. Интеграции Интеграции

| Сервис | Метод | Цель |
| --- | --- | --- |
| **GitHub API** | REST v3 / GraphQL | Получение PR‑метаданных, тэгов, чтение `package.json`. |
| **Jenkins** | JSON API | Список последних билд‑тегов. |
| **SDP Tracker (Yandex Tracker API)** | REST | Тайтл, описание SDP. |

## 9. Обработка ошибок и краевых случаев

- PR из чужого форка → предупреждение, но разрешить добавить вручную репозиторий.
- Несовпадение версий между `package.json` и последним тегом → лог «⚠️ Версии расходятся», использовать более свежую.
- Нет ни одной версии → устанавливаем `0.1.0`.
- При сбое интеграции — отображать баннер с время последней успешной синхронизации и кнопкой «Повторить».

---

© 2025 «SDP → RFC»